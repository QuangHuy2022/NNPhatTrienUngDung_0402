function render(){const filtered=State.getFiltered(DOM.searchInput.value);const sorted=State.getSorted(filtered);const paged=State.getPaged(sorted);DOM.tableBody.innerHTML='';paged.slice.forEach(p=>{const tr=document.createElement('tr');tr.setAttribute('data-bs-toggle','tooltip');tr.setAttribute('data-bs-placement','top');tr.setAttribute('title',p.description||'');tr.style.cursor='pointer';tr.addEventListener('click',()=>Modals.openDetail(p));const tdId=document.createElement('td');tdId.textContent=p.id;const tdTitle=document.createElement('td');tdTitle.textContent=p.title||'';const tdPrice=document.createElement('td');tdPrice.textContent=Utils.fmtMoney(p.price||0);const tdCat=document.createElement('td');tdCat.textContent=(p.category&&p.category.name)||'';const tdImg=document.createElement('td');const img=document.createElement('img');img.src=(p.images&&p.images[0])||'';img.alt='';img.style.width='48px';img.style.height='48px';img.style.objectFit='cover';img.className='rounded';tdImg.appendChild(img);tr.appendChild(tdId);tr.appendChild(tdTitle);tr.appendChild(tdPrice);tr.appendChild(tdCat);tr.appendChild(tdImg);DOM.tableBody.appendChild(tr)});Array.from(document.querySelectorAll('[data-bs-toggle=\"tooltip\"]')).forEach(el=>new bootstrap.Tooltip(el));renderPagination(paged.pages)}
function renderPagination(pages){DOM.pagination.innerHTML='';const cur=State.getCurrentPage();const prevLi=document.createElement('li');prevLi.className='page-item'+(cur===1?' disabled':'');const prevA=document.createElement('a');prevA.className='page-link';prevA.href='#';prevA.textContent='«';prevA.addEventListener('click',e=>{e.preventDefault();if(State.getCurrentPage()>1){State.setCurrentPage(State.getCurrentPage()-1);render()}});prevLi.appendChild(prevA);DOM.pagination.appendChild(prevLi);for(let i=1;i<=pages;i++){const li=document.createElement('li');li.className='page-item'+(i===cur?' active':'');const a=document.createElement('a');a.className='page-link';a.href='#';a.textContent=String(i);a.addEventListener('click',e=>{e.preventDefault();State.setCurrentPage(i);render()});li.appendChild(a);DOM.pagination.appendChild(li)}const nextLi=document.createElement('li');nextLi.className='page-item'+(cur===pages?' disabled':'');const nextA=document.createElement('a');nextA.className='page-link';nextA.href='#';nextA.textContent='»';nextA.addEventListener('click',e=>{e.preventDefault();if(State.getCurrentPage()<pages){State.setCurrentPage(State.getCurrentPage()+1);render()}});nextLi.appendChild(nextA);DOM.pagination.appendChild(nextLi)}
function exportViewCsv(){const filtered=State.getFiltered(DOM.searchInput.value);const sorted=State.getSorted(filtered);const {slice}=State.getPaged(sorted);const header='id,title,price,category,images';const rows=slice.map(p=>[p.id,JSON.stringify(p.title||''),p.price,(p.category&&p.category.name)||'',JSON.stringify((p.images||[]).join('|'))].join(','));Utils.downloadCsv([header,...rows],'products_view.csv')}
window.Render={render,renderPagination,exportViewCsv}
